# ğŸ“š è³‡æ–™å‰è™•ç†å®Œæ•´æŒ‡å—

## ğŸ”„ æ•´é«”æµç¨‹æ¶æ§‹

```
PDF æ³•æ¢æ–‡ä»¶
    â†“
[1] æ³•æ¢æå– (preprocess_article.py)
    â†“ (ç”Ÿæˆ JSON + CSV)
    â†“
[2] æ³•æ¢å„²å­˜è³‡æ–™åº« (save_law_article_to_database.py)
    â†“ (å­˜å…¥å‘é‡æ•¸æ“šåº«)
    â†“
æ¡ˆä¾‹çˆ¬å–
    â†“
[3] æ¡ˆä¾‹æå– (crawer.py)
    â†“ (æå–æ¡ˆä¾‹æ–‡æœ¬)
    â†“
[4] æ¡ˆä¾‹æ³•æ¢é…å° (automatic_find_article.py)
    â†“ (æå–é—œéµæ³•æ¢)
    â†“
[5] æ¡ˆä¾‹è£œå……æ³•æ¢ (search_deep_laws.py)
    â†“ (è£œå……ç›¸é—œæ³•æ¢)
    â†“
[6] æ¡ˆä¾‹å„²å­˜è³‡æ–™åº« (embed_cases_to_chroma.py)
    â†“ (å­˜å…¥å‘é‡æ•¸æ“šåº«)
    â†“
âœ… å®Œæˆ - ç³»çµ±å¯ç”¨
```

---

## ğŸ“‹ è©³ç´°æ­¥é©Ÿèªªæ˜

### ğŸ” ç¬¬ 1 æ­¥ï¼šæ³•æ¢æå–

**æ–‡ä»¶**: `preprocess_article.py`

**åŠŸèƒ½**ï¼š
- å¾ PDF æ–‡ä»¶ä¸­æå–æ³•æ¢æ–‡æœ¬
- è‡ªå‹•è§£ææ¢æ–‡çµæ§‹ï¼ˆç¬¬ X æ¢ã€ç¬¬ Y æ¬¾ï¼‰
- æ¸…ç†å¤šé¤˜ç©ºç™½å’Œæ ¼å¼å•é¡Œ
- éæ¿¾æ‰éæ¢æ–‡éƒ¨åˆ†ï¼ˆå¦‚ç« ç¯€æ¨™é¡Œï¼‰

**è¼¸å…¥**ï¼š
- PDF æª”æ¡ˆæ”¾åœ¨ `article/` è³‡æ–™å¤¾
- æ”¯æ´å¤šå€‹ PDF æª”æ¡ˆæ‰¹é‡è™•ç†

**è¼¸å‡º**ï¼š
- ç”Ÿæˆ `{æ³•è¦åç¨±}.json` - æ¢æ–‡çµæ§‹åŒ–æ•¸æ“š
- ç”Ÿæˆ `{æ³•è¦åç¨±}.csv` - è¡¨æ ¼æ ¼å¼æ•¸æ“š

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python data_preprocess/preprocess_article.py
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```
âœ… å·²å°‡ è­‰åˆ¸å•†ç¶“ç‡ŸæœŸè²¨äº¤æ˜“è¼”åŠ©æ¥­å‹™ç®¡ç†è¦å‰‡.pdf çš„æ•¸æ“šä¿å­˜ç‚º
   è­‰åˆ¸å•†ç¶“ç‡ŸæœŸè²¨äº¤æ˜“è¼”åŠ©æ¥­å‹™ç®¡ç†è¦å‰‡.json å’Œ
   è­‰åˆ¸å•†ç¶“ç‡ŸæœŸè²¨äº¤æ˜“è¼”åŠ©æ¥­å‹™ç®¡ç†è¦å‰‡.csv
```

**ç”Ÿæˆçš„ CSV çµæ§‹**ï¼š
| æ¢æ–‡ | æ¬¾åˆ—è¡¨ | å…¨æ–‡ |
|------|--------|------|
| ç¬¬ 1 æ¢ | 1. æœ¬è¦å‰‡é©ç”¨æ–¼... \| 2. ç”³è«‹... | æ¢æ–‡çš„å®Œæ•´å…§å®¹ |
| ç¬¬ 2 æ¢ | ... | ... |

**ç”Ÿæˆçš„ JSON çµæ§‹**ï¼š
```json
{
  "1": {
    "title": "ç¬¬ 1 æ¢",
    "clauses": ["æœ¬è¦å‰‡é©ç”¨æ–¼...", "ç”³è«‹..."],
    "content": "æ¢æ–‡çš„å®Œæ•´å…§å®¹"
  },
  "2": { ... }
}
```

---

### ğŸ’¾ ç¬¬ 2 æ­¥ï¼šæ³•æ¢å„²å­˜è³‡æ–™åº«

**æ–‡ä»¶**: `save_law_article_to_database.py`

**åŠŸèƒ½**ï¼š
- è®€å–æå–çš„æ³•æ¢ï¼ˆJSON æˆ– CSVï¼‰
- å‘é‡åŒ–æ³•æ¢å…§å®¹
- å„²å­˜åˆ° Chroma å‘é‡æ•¸æ“šåº«
- æ”¯æ´æœç´¢å’Œé‡æ’åº

**è¼¸å…¥**ï¼š
- ç¬¬ 1 æ­¥ç”Ÿæˆçš„ CSV æª”æ¡ˆ
- ç’°å¢ƒè®Šæ•¸é…ç½®ï¼ˆå¦‚éœ€ï¼‰

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python data_preprocess/save_law_article_to_database.py
```

**é©—è­‰å„²å­˜**ï¼š
```bash
# æª¢æŸ¥æ˜¯å¦æˆåŠŸå„²å­˜
python -c "from utility.search_related_laws import LegalSearchEngine; \
           engine = LegalSearchEngine('./chroma_db', 'law_articles_csv_version1'); \
           print(f'æˆåŠŸ: å…± {len(engine.collection.get()['ids'])} å€‹æ–‡æª”')"
```

---

### ğŸ“° ç¬¬ 3 æ­¥ï¼šæ¡ˆä¾‹æå–

**æ–¹å¼ A - ä½¿ç”¨çˆ¬èŸ²**: `crawer.py`

**åŠŸèƒ½**ï¼š
- å¾ FSC å®˜æ–¹ç¶²ç«™çˆ¬å–è™•ç½°æ¡ˆä¾‹
- ä½¿ç”¨ Selenium æ¨¡æ“¬ç€è¦½å™¨
- è‡ªå‹•åˆ†é è™•ç†

**è¼¸å…¥**ï¼š
- ç„¡éœ€è¼¸å…¥æª”æ¡ˆ

**è¼¸å‡º**ï¼š
- `output.json` - åŒ…å«æ¡ˆä¾‹ URLã€æ¨™é¡Œã€æ—¥æœŸã€å…§å®¹

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python data_preprocess/crawer.py
```

**è¼¸å‡ºæ ¼å¼**ï¼š
```json
[
  {
    "url": "https://www.fsc.gov.tw/...",
    "subject": "åˆ¸å•†åˆ†å…¬å¸æ‡‰è¨­é¢¨éšªç®¡ç†éƒ¨é–€...",
    "date": "2025-09-30",
    "content": "è©³ç´°çš„è™•ç½°æ¡ˆä¾‹å…§å®¹..."
  }
]
```

---

### ğŸ”— ç¬¬ 4 æ­¥ï¼šæ¡ˆä¾‹æ³•æ¢é…å°

**æ–‡ä»¶**: `automatic_find_article.py`

**åŠŸèƒ½**ï¼š
- ä½¿ç”¨ OpenAI API åˆ†ææ¡ˆä¾‹æ–‡æœ¬
- è‡ªå‹•è­˜åˆ¥ç›¸é—œçš„æ³•è¦åç¨±å’Œæ¢æ–‡ç·¨è™Ÿ
- æå–æ¡ˆä¾‹ä¸­æ˜ç¢ºæåˆ°çš„æ³•æ¢

**è¼¸å…¥**ï¼š
- JSON æª”æ¡ˆï¼ˆä¾†è‡ªç¬¬ 3 æ­¥çš„ `output.json`ï¼‰

**è¼¸å‡º**ï¼š
- `processed_cases.csv` - åŒ…å«æ¡ˆä¾‹å’Œå°æ‡‰çš„æ³•æ¢

**ç’°å¢ƒéœ€æ±‚**ï¼š
- `OPENAI_API_KEY` å·²è¨­å®š
- å¯é¸ï¼š`USE_OLLAMA=true` ä½¿ç”¨æœ¬åœ° Ollama

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# æ–¹å¼ 1ï¼šå–®ä¸€æ¡ˆä¾‹è¼¸å…¥
python data_preprocess/automatic_find_article.py
# é¸æ“‡æ¨¡å¼ 1ï¼Œç„¶å¾Œè¼¸å…¥æ¡ˆä¾‹æ–‡æœ¬

# æ–¹å¼ 2ï¼šæ‰¹é‡è™•ç† JSON
python data_preprocess/automatic_find_article.py
# é¸æ“‡æ¨¡å¼ 2ï¼Œå®ƒæœƒè‡ªå‹•è®€å– case.json
```

**AI æç¤ºè©**ï¼š
```
è«‹æ ¹æ“šæ¡ˆä¾‹æ‰¾å‡ºç›¸é—œçš„æ³•è¦åç¨±å’Œæ¢æ–‡ç·¨è™Ÿã€‚
æ ¼å¼: {"æ³•å¾‹æ¡ˆä¾‹": "...", "ç›¸é—œæ³•è¦": [{"æ³•è¦åç¨±": "...", "æ¢æ–‡": ["15", "20-1"]}]}
```

**è¼¸å‡ºæ ¼å¼**ï¼š
```csv
æ³•å¾‹æ¡ˆä¾‹,ç›¸é—œæ³•æ¢
"æ¡ˆä¾‹æ–‡æœ¬...", "{"ç›¸é—œæ³•è¦": [{"æ³•è¦åç¨±": "...", "æ¢æ–‡": [...]}]}"
```

---

### ğŸ” ç¬¬ 5 æ­¥ï¼šæ¡ˆä¾‹è£œå……æ³•æ¢

**æ–‡ä»¶**: `search_deep_laws.py`

**åŠŸèƒ½**ï¼š
- ä½¿ç”¨ LLM åˆ†ææ¡ˆä¾‹ç”Ÿæˆæœç´¢æŸ¥è©¢
- æœç´¢ç›¸é—œçš„è£œå……æ³•æ¢
- ä½¿ç”¨ LLM è©•ä¼°æœç´¢çµæœçš„æœ‰ç”¨æ€§
- å¾ 270+ å€‹æ¡ˆä¾‹ä¸­è£œå……å®Œæ•´çš„æ³•æ¢

**è¼¸å…¥**ï¼š
- `processed_cases.csv` (ä¾†è‡ªç¬¬ 4 æ­¥)
- è®€å–ç¬¬ 90+ è¡Œçš„æ•¸æ“š

**è¼¸å‡º**ï¼š
- `law_supplement_results_2014_90.json` - æ¯å€‹æ¡ˆä¾‹çš„è£œå……æ³•æ¢

**ç’°å¢ƒéœ€æ±‚**ï¼š
- `OPENAI_API_KEY` å·²è¨­å®š
- Chroma å‘é‡æ•¸æ“šåº«å·²åˆå§‹åŒ–ï¼ˆå«æ³•æ¢ï¼‰

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python data_preprocess/search_deep_laws.py
```

**åŸ·è¡Œæµç¨‹**ï¼š
1. è®€å– CSV æª”æ¡ˆï¼ˆ270 ç­†æ¡ˆä¾‹ï¼‰
2. å°æ¯å€‹æ¡ˆä¾‹ç”Ÿæˆ 3-5 å€‹æœç´¢æŸ¥è©¢
3. åŸ·è¡Œå‘é‡æœç´¢å’Œé‡æ’åº
4. ä½¿ç”¨ LLM è©•ä¼°æœç´¢çµæœ
5. ä¿å­˜è£œå……æ³•æ¢çµæœ

**æ‰¹æ¬¡å„²å­˜**ï¼š
- æ¯è™•ç† 30 å€‹æ¡ˆä¾‹è‡ªå‹•ä¿å­˜ä¸€æ¬¡
- æ”¯æŒä¸­æ–·æ¢å¾©

**è¼¸å‡ºæ ¼å¼**ï¼š
```json
{
  "original_law_text": "æ¡ˆä¾‹æåˆ°çš„åŸå§‹æ³•æ¢...",
  "generated_queries": ["æŸ¥è©¢ 1", "æŸ¥è©¢ 2", "æŸ¥è©¢ 3"],
  "supplementary_laws": [
    {
      "id": "æ³•æ¢ ID",
      "metadata": {"æ³•å¾‹åç¨±": "...", "æ¢": "..."},
      "content": "å®Œæ•´æ³•æ¢å…§å®¹"
    }
  ]
}
```

---

### ğŸ“‚ ç¬¬ 6 æ­¥ï¼šæ¡ˆä¾‹å„²å­˜è³‡æ–™åº«

**æ–‡ä»¶**: `database_utility/embed_cases_to_chroma.py`

**åŠŸèƒ½**ï¼š
- è®€å–è™•ç†éçš„æ¡ˆä¾‹
- å‘é‡åŒ–æ¡ˆä¾‹å…§å®¹
- å„²å­˜åˆ° Chroma å‘é‡æ•¸æ“šåº«
- æ”¯æ´å¿«é€Ÿç›¸ä¼¼åº¦æœç´¢

**è¼¸å…¥**ï¼š
- è™•ç†éçš„æ¡ˆä¾‹æ–‡ä»¶ï¼ˆCSV æˆ– JSONï¼‰

**è¼¸å‡º**ï¼š
- æ•¸æ“šå„²å­˜åˆ° `./chroma_db/`

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python database_utility/embed_cases_to_chroma.py
```

**é©—è­‰å„²å­˜**ï¼š
```bash
# æ¸¬è©¦æœç´¢åŠŸèƒ½
python -c "from utility.search_related_laws import LegalSearchEngine; \
           engine = LegalSearchEngine('./chroma_db'); \
           results = engine.search('è³‡æœ¬é©è¶³ç‡'); \
           print(f'æœç´¢çµæœ: {len(results)} å€‹æ–‡æª”')"
```

---

## âš™ï¸ é…ç½®å’Œç’°å¢ƒè®Šæ•¸

### å¿…éœ€çš„ç’°å¢ƒè®Šæ•¸

```bash
# OpenAI é…ç½®
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o  # æˆ–å…¶ä»–æ¨¡å‹

# å¯é¸ï¼šä½¿ç”¨ Ollama æœ¬åœ°æ¨¡å‹
USE_OLLAMA=false
OLLAMA_MODEL=mistral
OLLAMA_BASE_URL=http://localhost:11434
```

### è¨­å®šæ–¹å¼

**æ–¹æ³• 1ï¼š.env æª”æ¡ˆ**
```bash
echo "OPENAI_API_KEY=sk-..." > .env
echo "OPENAI_MODEL=gpt-4o" >> .env
```

**æ–¹æ³• 2ï¼šä½¿ç”¨é…ç½®è…³æœ¬**
```bash
source config_loader.sh openai
# æˆ–
source config_loader.sh ollama
```

---

## ğŸ“Š æ•¸æ“šæµå‘åœ–

```
PDF æª”æ¡ˆ (article/)
    â†“
preprocess_article.py
    â†“
JSON + CSV (æ¢æ–‡)
    â†“
save_law_article_to_database.py
    â†“
Chroma DB (å‘é‡åŒ–æ³•æ¢)
    â†“
search_deep_laws.py (æœç´¢è£œå……æ³•æ¢æ™‚ä½¿ç”¨)
â†™      â†“      â†˜
    æ¡ˆä¾‹ç¶²é 
        â†“
    crawer.py
        â†“
    output.json (åŸå§‹æ¡ˆä¾‹)
        â†“
    automatic_find_article.py
        â†“
    processed_cases.csv (æ¡ˆä¾‹ + ä¸»è¦æ³•æ¢)
        â†“
    search_deep_laws.py
        â†“
    law_supplement_results_2014_90.json (è£œå……æ³•æ¢)
        â†“
    embed_cases_to_chroma.py
        â†“
    Chroma DB (å‘é‡åŒ–æ¡ˆä¾‹)
```

---

## âœ… å®Œæ•´æª¢æŸ¥æ¸…å–®

### å‰ç½®æº–å‚™
- [ ] Python 3.10+ å·²å®‰è£
- [ ] è™›æ“¬ç’°å¢ƒå·²å•Ÿå‹•
- [ ] ä¾è³´åŒ…å·²å®‰è£ (`pip install -r requirements.txt`)
- [ ] `.env` æª”æ¡ˆå·²é…ç½®
- [ ] OpenAI API Key æœ‰æ•ˆ

### ç¬¬ 1-2 æ­¥ï¼šæ³•æ¢è™•ç†
- [ ] PDF æª”æ¡ˆåœ¨ `article/` è³‡æ–™å¤¾
- [ ] åŸ·è¡Œ `preprocess_article.py`
- [ ] é©—è­‰ç”Ÿæˆçš„ JSON å’Œ CSV
- [ ] åŸ·è¡Œ `save_law_article_to_database.py`
- [ ] é©—è­‰ Chroma DB åŒ…å«æ³•æ¢

### ç¬¬ 3-4 æ­¥ï¼šæ¡ˆä¾‹æå–èˆ‡é…å°
- [ ] åŸ·è¡Œ `crawer.py` çˆ¬å–æ¡ˆä¾‹ï¼ˆå¯é¸ï¼‰
- [ ] æˆ–æº–å‚™ `case.json` æª”æ¡ˆ
- [ ] åŸ·è¡Œ `automatic_find_article.py`
- [ ] é©—è­‰ `processed_cases.csv` ç”Ÿæˆ

### ç¬¬ 5-6 æ­¥ï¼šè£œå……èˆ‡å„²å­˜
- [ ] ç¢ºèªæœ‰ `OPENAI_API_KEY`
- [ ] åŸ·è¡Œ `search_deep_laws.py`
- [ ] é©—è­‰ `law_supplement_results_2014_90.json` ç”Ÿæˆ
- [ ] åŸ·è¡Œ `embed_cases_to_chroma.py`
- [ ] é©—è­‰æ¡ˆä¾‹å„²å­˜åˆ° Chroma DB

### æœ€çµ‚é©—è­‰
- [ ] æ‰€æœ‰æ•¸æ“šå·²å„²å­˜åˆ° `./chroma_db/`
- [ ] å¯ä»¥åŸ·è¡Œæœç´¢æ¸¬è©¦
- [ ] UI æ‡‰ç”¨å¯ä»¥æ­£å¸¸æŸ¥è©¢

---

## ğŸ› å¸¸è¦‹å•é¡Œèˆ‡è§£æ±º

### å•é¡Œ 1ï¼šSSL è­‰æ›¸é©—è­‰å¤±æ•—
**ç—‡ç‹€**ï¼š`SSLError(SSLCertificateVerifyError)`

**è§£æ±º**ï¼šè¦‹ [SSL_CERTIFICATE_FIX.md](./SSL_CERTIFICATE_FIX.md)

---

### å•é¡Œ 2ï¼šæ‰¾ä¸åˆ° CSV æª”æ¡ˆ
**ç—‡ç‹€**ï¼š`FileNotFoundError: [Errno 2] No such file or directory: 'processed_cases.csv'`

**è§£æ±º**ï¼š
```bash
# ç¢ºä¿å¾æ­£ç¢ºçš„ç›®éŒ„åŸ·è¡Œ
python data_preprocess/search_deep_laws.py

# æˆ–æª¢æŸ¥æª”æ¡ˆä½ç½®
ls -la data_preprocess/processed_cases.csv
```

---

### å•é¡Œ 3ï¼šOpenAI API é€Ÿç‡é™åˆ¶
**ç—‡ç‹€**ï¼š`RateLimitError: Rate limit exceeded`

**è§£æ±º**ï¼š
- è…³æœ¬æœƒè‡ªå‹•é‡è©¦ï¼ˆæœ€å¤š 5 æ¬¡ï¼‰
- æ¯æ¬¡é‡è©¦é–“éš”åŠ å€
- ç­‰å¾… API é…é¡æ¢å¾©

---

### å•é¡Œ 4ï¼šChroma DB é€£æ¥å¤±æ•—
**ç—‡ç‹€**ï¼š`Failed to connect to Chroma`

**è§£æ±º**ï¼š
```bash
# é‡æ–°åˆå§‹åŒ– Chroma DB
rm -rf ./chroma_db/
python data_preprocess/save_law_article_to_database.py
```


## ğŸ’¡ æœ€ä½³å¯¦è¸

### âœ… DOï¼ˆæ‡‰è©²åšï¼‰
- âœ… å…ˆé©—è­‰æ¯ä¸€æ­¥çš„è¼¸å‡º
- âœ… å®šæœŸå‚™ä»½ Chroma DB
- âœ… ç›£æ§ API ä½¿ç”¨é‡å’Œæˆæœ¬
- âœ… ä½¿ç”¨æ‰¹é‡è™•ç†ç¸®çŸ­ç¸½è€—æ™‚
- âœ… è¨˜éŒ„è©³ç´°çš„æ—¥èªŒç”¨æ–¼èª¿è©¦

### âŒ DON'Tï¼ˆä¸æ‡‰è©²åšï¼‰
- âŒ ä¸è¦è·³éæ•¸æ“šé©—è­‰æ­¥é©Ÿ
- âŒ ä¸è¦åŒæ™‚åŸ·è¡Œå¤šå€‹è™•ç†æµç¨‹
- âŒ ä¸è¦å¿½è¦– OpenAI é…é¡é™åˆ¶
- âŒ ä¸è¦åˆªé™¤ä¸­é–“ç”Ÿæˆçš„æª”æ¡ˆ
- âŒ ä¸è¦åœ¨æ²’æœ‰å‚™ä»½çš„æƒ…æ³ä¸‹ä¿®æ”¹ DB




